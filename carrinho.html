<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Carrinho | Lua Cheia</title>

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">

<style>
:root{
  --card:rgba(255,255,255,.05);
  --border:rgba(255,255,255,.08);
  --gold:#facc15;
  --blue:#38bdf8;
}

*{margin:0;padding:0;box-sizing:border-box;font-family:'Inter',sans-serif}

body{
  background:radial-gradient(circle at top,#111827,#020617);
  color:#fff;
  padding-top:120px; /* COMPENSA HEADER FIXO */
}

/* ===== HEADER FIXO ===== */
header{
  position:fixed;
  top:0;
  left:0;
  width:100%;
  z-index:1000;
  background:rgba(2,6,23,.9);
  backdrop-filter:blur(14px);
  border-bottom:1px solid var(--border);
}

.topo{
  max-width:1100px;
  margin:auto;
  padding:16px 20px;
  display:flex;
  justify-content:space-between;
  align-items:center;
}

.topo h1{
  color:var(--gold);
  font-size:20px;
}

.menu-btn{
  font-size:26px;
  cursor:pointer;
  display:block;
}

/* MENU MOBILE */
nav{
  position:fixed;
  top:70px;
  left:0;
  width:100%;
  display:none;
  flex-direction:column;
  background:rgba(2,6,23,.97);
  border-bottom:1px solid var(--border);
}

nav a{
  padding:16px 20px;
  color:#fff;
  text-decoration:none;
  border-top:1px solid var(--border);
}

nav a.active{
  color:var(--gold);
  font-weight:600;
}

/* DESKTOP */
@media(min-width:768px){
  .menu-btn{display:none}

  nav{
    position:static;
    display:flex!important;
    flex-direction:row;
    justify-content:center;
    background:transparent;
    border:none;
  }

  nav a{
    border:none;
    padding:20px;
    opacity:.85;
  }

  nav a:hover{opacity:1}
}

/* ===== MAIN ===== */
main{
  max-width:900px;
  margin:auto;
  padding:30px 20px;
}

h2{
  margin:30px 0 12px;
  color:var(--blue);
}

.card{
  background:var(--card);
  border:1px solid var(--border);
  border-radius:18px;
  padding:16px;
  margin-bottom:12px;
}

.total{
  margin-top:20px;
  border:1px solid var(--border);
  padding:20px;
  border-radius:20px;
  color:var(--gold);
}

input,select{
  width:100%;
  padding:14px;
  margin-bottom:15px;
  border-radius:14px;
  border:1px solid var(--border);
  background:rgba(255,255,255,.05);
  color:#fff;
}

#pix-box{
  display:none;
  margin-top:20px;
  border:1px solid rgba(34,197,94,.4);
  padding:20px;
  border-radius:22px;
  text-align:center;
}

.termos{
  display:flex;
  gap:10px;
  margin-top:20px;
  padding:15px;
  border-radius:16px;
  background:rgba(255,255,255,.04);
  border:1px solid var(--border);
  font-size:13px;
}

.btn-finalizar{
  margin-top:25px;
  background:linear-gradient(135deg,#22c55e,#16a34a);
  color:#022c22;
  padding:16px;
  border:none;
  border-radius:35px;
  width:100%;
  font-size:17px;
  font-weight:700;
  cursor:pointer;
}
</style>
</head>

<body>

<header>
  <div class="topo">
    <h1>üåô Lua Cheia</h1>
    <div class="menu-btn" onclick="toggleMenu()">‚ò∞</div>
  </div>

  <nav id="menu">
    <a href="index.html">In√≠cio</a>
    <a href="refeicoes.html">Refei√ß√µes</a>
    <a href="bebidas.html">Bebidas</a>
    <a href="carrinho.html" class="active">üßæ Comanda</a>
  </nav>
</header>

<main>

<h2>üßæ Itens do Pedido</h2>
<div id="lista"></div>
<div id="total" class="total"></div>

<h2>üë§ Mesa</h2>
<input id="mesa" placeholder="Ex: Mesa 3">

<h2>‚è∞ Hor√°rio</h2>
<select id="horario">
  <option value="">Selecione</option>
  <option>11:30</option><option>12:00</option>
  <option>12:30</option><option>13:00</option>
  <option>13:30</option><option>14:00</option>
</select>

<h2>üí≥ Pagamento</h2>
<select id="pagamento" onchange="mostrarPix()">
  <option value="">Selecione</option>
  <option>Pix</option>
  <option>Cart√£o</option>
  <option>Dinheiro</option>
</select>

<div id="pix-box">
  <p>Pagamento de 50% via Pix</p>
  <img id="pix-qrcode" style="max-width:220px">
  <p id="pix-copia"></p>
</div>

<label class="termos">
  <input type="checkbox" id="termos">
  Aceito os termos da reserva
</label>

<button class="btn-finalizar" onclick="finalizarPedido()">üì≤ Confirmar Reserva</button>

</main>

<!-- FIREBASE -->
<script type="module" src="./js/firebase.js"></script>

<script type="module">
import { db } from "./js/firebase.js";
import { collection, addDoc, query, where, getDocs, Timestamp }
from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

/* MENU */
function toggleMenu(){
  const menu = document.getElementById("menu");
  menu.style.display = menu.style.display === "flex" ? "none" : "flex";
}
window.toggleMenu = toggleMenu;

/* CARRINHO */
let carrinho = JSON.parse(localStorage.getItem("carrinho")) || [];

function carregarCarrinho(){
  const l=document.getElementById("lista");
  const t=document.getElementById("total");
  l.innerHTML=""; let sub=0;

  if(!carrinho.length){
    l.innerHTML="Carrinho vazio";
    return;
  }

  carrinho.forEach(i=>{
    sub+=i.preco*i.qtd;
    l.innerHTML+=`
      <div class="card">
        ${i.nome} ‚Äî R$ ${i.preco} x ${i.qtd}
      </div>`;
  });

  const taxa=sub*0.1;
  const total=sub+taxa;
  const sinal=total*0.5;

  t.innerHTML=`Total: R$ ${total.toFixed(2)}<br>Sinal: R$ ${sinal.toFixed(2)}`;
  gerarPix(sinal);
}

function gerarPix(v){
  const p=`PIX | Lua Cheia | R$ ${v.toFixed(2)}`;
  document.getElementById("pix-qrcode").src=
  `https://api.qrserver.com/v1/create-qr-code/?size=300x300&data=${encodeURIComponent(p)}`;
  document.getElementById("pix-copia").innerText=p;
}

window.mostrarPix = function(){
  document.getElementById("pix-box").style.display =
  pagamento.value==="Pix"?"block":"none";
}

window.finalizarPedido = async function(){

  if(!mesa.value || !horario.value || !pagamento.value)
    return alert("Preencha todos os campos");

  if(!termos.checked)
    return alert("Aceite os termos");

  const q = query(
    collection(db,"reservas_almoco"),
    where("mesa","==",mesa.value),
    where("horario","==",horario.value)
  );

  const existe = await getDocs(q);
  if(!existe.empty){
    alert("‚ùå Essa mesa j√° est√° reservada nesse hor√°rio.");
    return;
  }

  await addDoc(collection(db,"reservas_almoco"),{
    mesa: mesa.value,
    horario: horario.value,
    pagamento: pagamento.value,
    itens: carrinho,
    status: "pendente",
    criadoEm: Timestamp.now()
  });

  localStorage.removeItem("carrinho");
  alert("‚úÖ Reserva confirmada com sucesso!");
  window.open("https://wa.me/5584999999999","_blank");
}

document.addEventListener("DOMContentLoaded",carregarCarrinho);
</script>

</body>
</html>
